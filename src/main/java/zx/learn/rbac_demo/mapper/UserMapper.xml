<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- namespace指用户自定义的命名空间。 -->
<mapper namespace="zx.learn.rbac_demo.mapper.UserMapper">

    <select id="listUserRoleByUserId" resultType="zx.learn.rbac_demo.entity.Role">
        select r.role_id, role_name
        from user
            left join user_role ur on user.user_id = ur.user_id
            left join role r on ur.role_id = r.role_id
        where ur.user_id = #{userId}
    </select>

    <select id="listResourceByUserId" resultType="zx.learn.rbac_demo.entity.Resource">
        select re.resource_id, resource_name, parent_id, type, url, permission
        from user
            left join user_role ur on user.user_id = ur.user_id
            left join role r on ur.role_id = r.role_id
            left join role_resource rr on r.role_id = rr.role_id
            left join resource re on rr.resource_id = re.resource_id
        where ur.user_id = #{userId}
    </select>
    <update id="updateUserInfo">
         update user
         <set>
             <if test="userName != null and userName != ''">user_name= #{userName} ,</if>
             <if test="userPassword != null and userPassword != ''">user_password= #{userPassword} ,</if>
             <if test="userEmail != null and userName != ''">user_email =#{userEmail} ,</if>
             <if test="userPhone != null and userPhone != ''">user_phone= #{userPhone} ,</if>
         </set>
         set  user_password = #{userPassword}
           where user_id = #{userId} ;
    </update>
    <insert id="addUser">
        insert into user ( user_name, user_password, user_email, user_phone) " +
            "values (#{userName} ,#{userPassword},#{userEmail} ,#{userPhone}  );
    </insert>


</mapper>
